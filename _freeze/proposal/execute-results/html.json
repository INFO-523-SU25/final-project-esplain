{
  "hash": "f36aa09e90df43d4ed6cd3afbc3cb8b6",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Whistle Bias?\"\nsubtitle: \"Investigating Referee Influence on WNBA Home Game Outcomes Using Data Mining\"\nauthor: \n  - name: \"Amy Esplain\"\n    affiliations:\n      - name: \"College of Information Science, University of Arizona\"\ndescription: \"This project aims to investigate potential officiating bias in WNBA games by analyzing referee crew assignments, foul distributions, and game outcomes. The primary objective is to determine whether certain referee combinations disproportionately favor home teams or exhibit consistent patterns of foul disparities.\"\nformat:\n  html:\n    code-tools: true\n    code-overflow: wrap\n    code-line-numbers: true\n    embed-resources: true\neditor: visual\ncode-annotations: hover\nexecute:\n  warning: false\njupyter: python3\n---\n\n::: {#load-pkgs .cell message='false' execution_count=1}\n``` {.python .cell-code}\n# For data handling\nimport pandas as pd\nimport numpy as np\n\n# For clustering\nfrom sklearn.cluster import KMeans\nfrom sklearn.preprocessing import StandardScaler\n\n# For visualization\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.decomposition import PCA\n```\n:::\n\n\n## Dataset\n\nThe dataset required for this project is a granular play-by-play level dataset in order to capture the fouls called within a game with an identifiable referee. The chosen dataset is from Kaggle created by Vladislav Shufinskiy ([dataset link](https://www.kaggle.com/datasets/brains14482/nba-playbyplay-and-shotdetails-data-19962021/data)) who combined several sources into several datasets for publicly available use. I am choosing to use this source that has been created by another individual due to the granular nature of this project. If I were I collect this data myself, it would require extraneous effort due to limitations on API data requests per game for play-by-play details.\n\nThe dataset used in this analysis is from the 2022, 2023, 2024 WNBA season that was webscraped from CDN.NBA.COM by Vladislav Shufinskiy. The dataset will use all games available including in-season, playoffs and finals in order to increase sample size for the analysis.\n\n::: {#cell-load-dataset .cell message='false' execution_count=2}\n``` {.python .cell-code}\n# Import WNBA data from the data folder\nimport os\n\n# Define the data folder path\ndata_folder = \"data\"\n\n# Load individual season data\nwnba_2022 = pd.read_csv(os.path.join(data_folder, \"wnba_2022.csv\"))\nwnba_2023 = pd.read_csv(os.path.join(data_folder, \"wnba_2023.csv\"))\nwnba_2024 = pd.read_csv(os.path.join(data_folder, \"wnba_2024.csv\"))\n\n# Combine all seasons into one dataset\nwnba_data = pd.concat([wnba_2022, wnba_2023, wnba_2024], ignore_index=True)\n\n# Display basic information about the dataset\nprint(f\"Total records across all seasons: {len(wnba_data):,}\")\nprint(f\"Columns in dataset: {wnba_data.shape[1]}\")\nprint(f\"Dataset shape: {wnba_data.shape}\")\n\n# Show first few rows where the officialId is not null\nprint(\"\\nDataset columns:\")\nprint(wnba_data.columns.tolist())\n\nprint(\"\\nExample of the dataset:\")\n# Filter for rows where officialId is not null and show first 5\nofficial_data = wnba_data[wnba_data['officialId'].notnull()]\n\nofficial_data.head(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTotal records across all seasons: 28,103\nColumns in dataset: 57\nDataset shape: (28103, 57)\n\nDataset columns:\n['actionNumber', 'clock', 'timeActual', 'period', 'periodType', 'actionType', 'subType', 'qualifiers', 'personId', 'x', 'y', 'possession', 'scoreHome', 'scoreAway', 'edited', 'orderNumber', 'xLegacy', 'yLegacy', 'isFieldGoal', 'side', 'description', 'personIdsFilter', 'teamId', 'teamTricode', 'descriptor', 'jumpBallRecoveredName', 'jumpBallRecoverdPersonId', 'playerName', 'playerNameI', 'jumpBallWonPlayerName', 'jumpBallWonPersonId', 'jumpBallLostPlayerName', 'jumpBallLostPersonId', 'shotDistance', 'shotResult', 'shotActionNumber', 'reboundTotal', 'reboundDefensiveTotal', 'reboundOffensiveTotal', 'pointsTotal', 'assistPlayerNameInitial', 'assistPersonId', 'assistTotal', 'turnoverTotal', 'stealPlayerName', 'stealPersonId', 'officialId', 'foulPersonalTotal', 'foulTechnicalTotal', 'foulDrawnPlayerName', 'foulDrawnPersonId', 'blockPlayerName', 'blockPersonId', 'gameId', 'isTargetScoreLastPeriod', 'area', 'areaDetail']\n\nExample of the dataset:\n```\n:::\n\n::: {#load-dataset .cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>actionNumber</th>\n      <th>clock</th>\n      <th>timeActual</th>\n      <th>period</th>\n      <th>periodType</th>\n      <th>actionType</th>\n      <th>subType</th>\n      <th>qualifiers</th>\n      <th>personId</th>\n      <th>x</th>\n      <th>...</th>\n      <th>foulPersonalTotal</th>\n      <th>foulTechnicalTotal</th>\n      <th>foulDrawnPlayerName</th>\n      <th>foulDrawnPersonId</th>\n      <th>blockPlayerName</th>\n      <th>blockPersonId</th>\n      <th>gameId</th>\n      <th>isTargetScoreLastPeriod</th>\n      <th>area</th>\n      <th>areaDetail</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>38</th>\n      <td>50</td>\n      <td>PT05M11.00S</td>\n      <td>2022-08-18T02:15:47Z</td>\n      <td>1</td>\n      <td>REGULAR</td>\n      <td>foul</td>\n      <td>personal</td>\n      <td>NaN</td>\n      <td>1628287</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>Wilson</td>\n      <td>1628932.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>46</th>\n      <td>60</td>\n      <td>PT04M38.00S</td>\n      <td>2022-08-18T02:16:46.900Z</td>\n      <td>1</td>\n      <td>REGULAR</td>\n      <td>turnover</td>\n      <td>out-of-bounds</td>\n      <td>NaN</td>\n      <td>1628276</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>56</th>\n      <td>68</td>\n      <td>PT03M58.00S</td>\n      <td>2022-08-18T02:20:32.100Z</td>\n      <td>1</td>\n      <td>REGULAR</td>\n      <td>foul</td>\n      <td>personal</td>\n      <td>NaN</td>\n      <td>1629498</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>Cunningham</td>\n      <td>1629482.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>68</th>\n      <td>85</td>\n      <td>PT02M23.00S</td>\n      <td>2022-08-18T02:22:29.500Z</td>\n      <td>1</td>\n      <td>REGULAR</td>\n      <td>foul</td>\n      <td>personal</td>\n      <td>2freethrow</td>\n      <td>1629488</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>Wilson</td>\n      <td>1628932.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>77</th>\n      <td>95</td>\n      <td>PT01M59.00S</td>\n      <td>2022-08-18T02:23:44Z</td>\n      <td>1</td>\n      <td>REGULAR</td>\n      <td>foul</td>\n      <td>personal</td>\n      <td>NaN</td>\n      <td>1629482</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>Wilson</td>\n      <td>1628932.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>90</th>\n      <td>117</td>\n      <td>PT00M09.40S</td>\n      <td>2022-08-18T02:26:14.700Z</td>\n      <td>1</td>\n      <td>REGULAR</td>\n      <td>foul</td>\n      <td>personal</td>\n      <td>inpenalty, 2freethrow</td>\n      <td>1629484</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>Wilson</td>\n      <td>1628932.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>113</th>\n      <td>148</td>\n      <td>PT08M39.00S</td>\n      <td>2022-08-18T02:32:02.900Z</td>\n      <td>2</td>\n      <td>REGULAR</td>\n      <td>foul</td>\n      <td>personal</td>\n      <td>NaN</td>\n      <td>203833</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>Gray</td>\n      <td>204334.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>116</th>\n      <td>153</td>\n      <td>PT08M31.00S</td>\n      <td>2022-08-18T02:32:47.900Z</td>\n      <td>2</td>\n      <td>REGULAR</td>\n      <td>turnover</td>\n      <td>out-of-bounds</td>\n      <td>NaN</td>\n      <td>203833</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>120</th>\n      <td>157</td>\n      <td>PT08M01.00S</td>\n      <td>2022-08-18T02:33:33.400Z</td>\n      <td>2</td>\n      <td>REGULAR</td>\n      <td>foul</td>\n      <td>offensive</td>\n      <td>NaN</td>\n      <td>1630387</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>Peddy</td>\n      <td>203035.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>121</th>\n      <td>159</td>\n      <td>PT08M01.00S</td>\n      <td>2022-08-18T02:33:33.400Z</td>\n      <td>2</td>\n      <td>REGULAR</td>\n      <td>turnover</td>\n      <td>offensive foul</td>\n      <td>NaN</td>\n      <td>1630387</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1042200101</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n<p>10 rows × 57 columns</p>\n</div>\n```\n:::\n:::\n\n\n## Research Questions\n\nThe research questions guiding this project are designed to uncover latent patterns in officiating behavior within the WNBA using unsupervised data mining techniques. Rather than testing predefined hypotheses, the goal is to explore underlying structures and trends in referee decision-making that may indicate systemic tendencies or inconsistencies.\n\n#### 1. Do home teams have significantly higher win rates under specific referee crews?\n\nThis question aims to identify clusters of referee crews associated with elevated home team win rates. The project will explore whether specific officiating crews are consistently linked to favorable home outcomes. Patterns that emerge may reflect officiating tendencies that unintentionally reinforce home-court advantage.\n\n#### 2. When games are officiated by certain referee combinations, do they have higher or lower foul disparity?\n\nThis question focuses on foul differential as a key indicator of officiating style. The analysis seeks to reveal groups of crews with similar behavioral patterns. Identifying outliers or consistently imbalanced combinations may point to structural officiating trends.\n\n#### 3. Do certain referees call more fouls on away teams?\n\nThis question narrows the scope to individual referees to examine whether certain officials consistently contribute to foul imbalances. The objective is to detect underlying officiating bias and identify individuals whose patterns deviate significantly from the normal.\n\n## Analysis plan\n\n### Problem Introduction\n\nThe Women’s National Basketball Association (WNBA) has experienced significant growth in recent years, accompanied by an increasing emphasis on data analytics to enhance forecasting and anomaly detection capabilities. This project seeks to evaluate the fairness of officiating in the WNBA by applying machine learning techniques to referee assignment data, foul differentials, and game outcomes. The primary objective is to identify potential officiating bias and assess the extent to which individual referees may contribute to a home-court advantage.\n\n### Problem Formulation\n\nThis study will examine potential officiating bias in WNBA games by analyzing referee assignment data, foul differentials, and game outcomes across multiple seasons. The analysis will proceed in the following stages:\n\n#### 1. Data Collection and Preprocessing\n\n-   **Data Sources:** Collecting data from <https://www.kaggle.com/datasets/brains14482/nba-playbyplay-and-shotdetails-data-19962021/data> which is a play-by-play datasets with referee assignments.\n\n-   **Variables of Interest:**\n\n    -   Game metadata: date, teams, location (home/away), final scores\n    -   Referee assignments (names or IDs, crew combinations)\n    -   Team foul counts\n    -   Game outcomes (win/loss, point differential)\n\n-   **Data Cleaning:**\n\n    -   Normalize referee names across games\n    -   Merge datasets to associate referee crews with game-level statistics\n    -   Handle missing or inconsistent values\n\n#### 2. Exploratory Data Analysis\n\nTo validate that the data supports our research questions, key features were explored using distributions and summary statistics:\n\n-   Summarize foul counts by team and referee to understand Foul Differential Distribution.\n-   Visualize average foul differential by referee and referee crew to see if there is skewness which could suggest certain crews favor one side.\n-   Compute home vs. away win rates across different referee combinations Crews with consistently higher home win rates may indicate officiating bias regardless of foul disparities.\n-   Generate pairwise correlations to identify potentially relevant feature groupings. Specific investigation will look at whether foul differential has a meaningful impact on scoring.\n\n#### 3. Feature Engineering\n\nThe goal is to construct a comprehensive set of quantitative features that can characterize officiating tendencies and enable meaningful clustering. Below are several features that I plan to create:\n\n-   **Foul Differential:** The difference in total fouls called on the home team versus the away team. This feature serves as a proxy for imbalance in foul calls and is a central indicator of potential bias.\n\n-   **Total Fouls Per Game:**\\\n    The sum of fouls called on both teams, capturing referees’ strictness or leniency in foul calling. Calculated as fouls called on the away team minus fouls called on the home team.\n\n-   **Average Fouls Per Team:**\\\n    Computed as total fouls divided by the number of games officiated by a referee or crew. This helps normalize foul volume across varying sample sizes.\n\n-   **Free Throw Differential:**\\\n    The difference in free throw attempts between the home and away teams, which may reflect the practical consequences of foul calls.\n\n-   **Home Win Indicator:**\\\n    A binary variable denoting whether the home team won the game (1 = home team won, 0 = home team loss). Used to explore relationships between crew assignments and home-court advantage.\n\n-   **Referee and Crew Identifiers:**\\\n    Encoded categorical identifiers for individual referees and three-person crew combinations to enable grouping and aggregation across games. Referee names will be normalized and mapped to a consistent ID to support aggregation. A composite key will be created for the three referees per game to analyze group effects.\n\n-   **Normalization and Scaling:**\n\n    To prepare for K-means clustering, all continuous features will be standardized (e.g., z-score normalization) to ensure that variables are on the same scale and contribute equally to distance calculations in the clustering algorithm\n\n-   **Aggregation Strategy:**\n\n    Referee-level features will be aggregated across games to create a per-referee profile. Similarly, crew-level statistics will be generated by grouping games officiated by the same three-referee combinations. This aggregation supports both individual and crew-based cluster analysis.\n\n#### 4. Unsupervised Learning (Pattern Discovery)\n\n-   **K-Means Clustering:** Use K-means clustering to group:\n\n    -   Referee crew based on game-level foul and outcome patterns\n\n    -   Individual referees based on their aggregated officiating behavior across multiple games\n\n-   **Dimensionality Reduction:** Apply Principal Component Analysis (PCA) to identify latent components in officiating behavior (such as home bias, foul volume, crew consistency)\n\n#### 5. Cluster Interpretation\n\n-   Analyze each cluster’s centroid to identify distinguishing features (such as high foul disparity, frequent home wins)\n-   Label clusters based on behavioral tendencies (such as \"neutral crews\", \"home-favoring referees\", \"high-caller crews\")\n-   Identify any outlier referees or crews with extreme values\n\n#### 6. Reporting and Visualization\n\n-   Create visualizations including heatmaps, bar charts, and PCA plot to articulate findings\\\n-   Plot clustered referee data to visualize separation and cohesion\\\n-   Discuss implications of findings in the context of WNBA officiating policy and fairness\n-   Provide future recommendations to improve the analysis\n\n## Plan of Attack\n\n| Milestone | Task | Due Date |\n|------------------|------------------------------------|------------------|\n| Submit Proposal | Finalize and submit initial proposal for others to provide feedback | 8/3/2025 |\n| Revise Proposal | Address all peer feedback as needed | 8/6/2025 |\n| Submit Revised Proposal | Incorporate and address all feedback for instructor review | 8/8/2025 |\n| Data Collection & Cleaning | \\- Gather and clean WNBA game logs, referee assignments, and team stats <br> - Merge datasets and ensure consistent formatting | 8/10/2025 |\n| Feature Engineering & EDA | \\- Create variables such as foul differential, crew IDs, and home/away indicators <br> - Visualize trends and explore feature distributions | 8/12/2025 |\n| Pattern Discovery with K-means | \\- Standardize features and apply K-means clustering | 8/14/2025 |\n| Cluster Interpretation | \\- Interpret each cluster’s characteristics (e.g., home bias, foul disparity) <br> - Identify and analyze outlier referees or crews | 8/16/2025 |\n| Visual & Storytelling | Create and finalize visuals that showcase the clustering results, such as PCA plots and cluster heatmaps | 8/17/2025 |\n| Final Write-Up & Presentation | \\- Create, refine, and finalize the report, code, and presentation <br> - Ensure all results are well-documented and reproducible | 8/19/2025 |\n| Final Submission | \\- Submit final report, code, and presentation <br> - Back up to GitHub (or drive) | 8/20/2025 |\n\n### Repo Organization\n\n| Path / File | Description |\n|----------------------|--------------------------------------------------|\n| `.github/` | Contains GitHub-specific files, including workflows, actions, and issue management templates. |\n| `_extra/` | Stores miscellaneous files that do not fit into other project categories; serves as a repository for supplementary documents. |\n| `_freeze/` | Houses frozen environment files detailing the project’s setup and dependencies. |\n| `data/` | Directory for all essential data files, including input datasets and resources required for analysis. |\n| `images/` | Central repository for visual assets such as diagrams, charts, and screenshots used for documentation and presentations. |\n| `.gitignore` | Specifies files and directories to exclude from Git version control. |\n| `README.md` | Central documentation file providing project overview, setup instructions, and usage guidelines. |\n| `_quarto.yml` | Configuration file for Quarto, specifying rendering options and document settings. |\n| `about.qmd` | Provides contextual information about the project and introduces team members and their roles. |\n| `index.qmd` | Main page of the project write-up, including code, visualizations, and final results. |\n| `presentation.qmd` | Quarto file used to create a slideshow of the final project presentation. |\n| `project-final.Rproj` | RStudio project file that defines project-level settings for R-based workflows. |\n| `proposal.qmd` | Contains the project proposal, including dataset descriptions, metadata, research questions, and a weekly progress plan. |\n| `requirements.txt` | Lists required Python packages and versions necessary for reproducing the project environment. |\n\n### References\n\n\\[1\\] WNBA Dataset: https://www.kaggle.com/datasets/brains14482/nba-playbyplay-and-shotdetails-data-19962021/data used in the project\n\n",
    "supporting": [
      "proposal_files\\figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}